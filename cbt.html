<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CBT Exam Interface</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{
  box-sizing:border-box;
  font-family:'Inter', sans-serif;
}

body{
  margin:0;
  background: linear-gradient(135deg,#1e1f29,#2b2e3b);
  color:white;
  height:100vh;
  overflow:hidden;
}

/* ================= HEADER ================= */
header{
  padding:20px;
  font-size:24px;
  font-weight:600;
  text-align:center;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,0.1);
}

/* ================= UPLOAD PANEL ================= */
#uploadBox{
  padding:40px;
  text-align:center;
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(15px);
}

input[type="file"]{
  margin:15px;
}

input[type="number"]{
  width:3cm;
  height:1cm;
  padding:5px;
  margin:10px 5px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.2);
  background:rgba(255,255,255,0.08);
  color:white;
  text-align:center;
  font-size:16px;
  outline:none;
}

button{
  padding:12px 30px;
  border-radius:30px;
  border:none;
  cursor:pointer;
  font-weight:600;
  background:linear-gradient(45deg,#4da3ff,#0066ff);
  color:white;
}

/* ================= CONTAINER ================= */
#container{
  display:flex;
  height:100vh;
}

#pdfPanel{
  width:75%;
  position:relative;
  border-right:1px solid rgba(255,255,255,0.1);
}

#pdfViewer{
  width:100%;
  height:100%;
  border:none;
}

#timerFixed{
  position:absolute;
  top:20px;
  right:20px;
  background:rgba(0,0,0,0.6);
  padding:12px 25px;
  border-radius:40px;
  font-weight:600;
  backdrop-filter:blur(10px);
}

#rightPanel{
  width:25%;
  display:flex;
  flex-direction:column;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(20px);
}

/* ================= QUESTION LIST ================= */
#qList{
  height:45%;
  overflow:auto;
  padding:15px;
  border-bottom:1px solid rgba(255,255,255,0.1);

  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:8px;
}

/* ================= QUESTION BUTTONS ================= */
/* Centered numbers using flexbox */
.qbtn{
  width:0.75cm;
  height:0.75cm;
  border-radius:8px;
  border:none;
  background:rgba(255,255,255,0.08);
  color:white;
  font-size:11px;
  cursor:pointer;

  display: flex;
  justify-content: center;
  align-items: center;
}

.qbtn.active{ background:#0066ff; }
.qbtn.visited-attempted{ background:#2ecc71; }
.qbtn.visited-not-attempted{ background:#f39c12; }
.qbtn.marked-review{ background:#3498db; }

/* ================= ANSWER PANEL ================= */
#answerPanel{
  padding:20px;
  height:55%;
}

.optionBox{
  display:inline-block;
  margin:8px;
}

.optionBox label{
  display:block;
  width:35px;
  height:35px;
  border-radius:8px;
  background:rgba(255,255,255,0.1);
  text-align:center;
  line-height:35px;
  cursor:pointer;
}

.optionBox label.selected{
  background:#4da3ff;
  color:black;
}

.actionRow{
  display:flex;
  justify-content:space-between;
  margin-top:20px;
}

.smallBtn{
  width:48%;
}
</style>
</head>

<body>

<header id="mainHeader">CBT Examination Portal</header>

<div id="uploadBox">
  <h2>Load Examination</h2>

  Upload PDF<br>
  <input type="file" id="pdfUpload" accept="application/pdf"><br>

  Number of Questions<br>
  <input type="number" id="numQ" min="1"><br>

  Time Allocation<br>
  <input type="number" id="hours" placeholder="Hr" min="0" max="24">
  <input type="number" id="minutes" placeholder="Min" min="0" max="59"><br><br>

  <button onclick="initQuestions()">START EXAM</button>
</div>

<div id="container" style="display:none;">
  <div id="pdfPanel">
    <iframe id="pdfViewer"></iframe>
    <div id="timerFixed">00:00:00</div>
  </div>

  <div id="rightPanel">
    <div id="qList"></div>

    <div id="answerPanel">
      <h3>Question <span id="currentQ">1</span></h3>

      <div id="options"></div>

      <label>Integer Answer</label>
      <input type="number" id="intAns">

      <div class="actionRow">
        <button class="smallBtn" onclick="nextQuestion()">âžœ Next</button>
        <button class="smallBtn" onclick="markForReview()">ðŸ”– Review</button>
      </div>

      <br>
      <button style="width:100%;" onclick="submitAnswers()">ðŸ“Ž Submit</button>
    </div>
  </div>
</div>

<script>
let totalQ=0, answers={}, current=1;
let timerSec=0, timerInterval=null;
let visited={}, markedForReview={};

pdfUpload.onchange=e=>{
  let file=e.target.files[0];
  if(file){
    pdfViewer.src=URL.createObjectURL(file);
  }
};

function initQuestions(){
  totalQ=parseInt(numQ.value);
  let h=parseInt(hours.value)||0;
  let m=parseInt(minutes.value)||0;
  timerSec=(h*3600)+(m*60);

  if(!totalQ || timerSec<=0){
    alert("Enter valid questions and time.");
    return;
  }

  document.getElementById("uploadBox").style.display="none";
  document.getElementById("mainHeader").style.display="none";
  document.getElementById("container").style.display="flex";

  generateQuestions();
  loadQuestion(1);
  startTimer();
}

function generateQuestions(){
  let qList=document.getElementById("qList");
  qList.innerHTML="";
  for(let i=1;i<=totalQ;i++){
    let b=document.createElement("button");
    b.className="qbtn";
    b.innerText=i;
    b.onclick=()=>loadQuestion(i);
    qList.appendChild(b);
  }
}

function loadQuestion(n){
  current=n;
  visited[n]=true;
  updateStatus(n);
  document.getElementById("currentQ").innerText=n;

  document.querySelectorAll(".qbtn").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".qbtn")[n-1].classList.add("active");

  let optDiv=document.getElementById("options");
  optDiv.innerHTML="";
  ['A','B','C','D'].forEach(o=>{
    let d=document.createElement("div");
    d.className="optionBox";
    let label=document.createElement("label");
    label.innerText=o;
    label.onclick=()=>toggleOption(o,label);
    d.appendChild(label);
    optDiv.appendChild(d);
  });

  intAns.value="";
}

function toggleOption(o,label){
  label.classList.toggle("selected");
  let selected=[...document.querySelectorAll(".optionBox label.selected")].map(l=>l.innerText);
  if(selected.length>0){
    answers[current]={type:"mcq",val:selected};
    intAns.value="";
  } else delete answers[current];
  updateStatus(current);
}

intAns.addEventListener("input",()=>{
  let v=intAns.value.trim();
  if(v!==""){
    answers[current]={type:"int",val:v};
    document.querySelectorAll(".optionBox label").forEach(l=>l.classList.remove("selected"));
  } else delete answers[current];
  updateStatus(current);
});

function updateStatus(n){
  let btn=document.querySelectorAll(".qbtn")[n-1];
  btn.classList.remove("visited-attempted","visited-not-attempted","marked-review");

  if(markedForReview[n]) btn.classList.add("marked-review");
  else if(visited[n] && answers[n]) btn.classList.add("visited-attempted");
  else if(visited[n]) btn.classList.add("visited-not-attempted");
}

function nextQuestion(){
  if(current<totalQ) loadQuestion(current+1);
}

function markForReview(){
  markedForReview[current]=true;
  updateStatus(current);
}

function startTimer(){
  document.getElementById("timerFixed").innerText=formatTime(timerSec);
  timerInterval=setInterval(()=>{
    if(timerSec<=0){
      clearInterval(timerInterval);
      submitAnswers();
      return;
    }
    timerSec--;
    document.getElementById("timerFixed").innerText=formatTime(timerSec);
  },1000);
}

function formatTime(sec){
  let h=Math.floor(sec/3600);
  let m=Math.floor((sec%3600)/60);
  let s=sec%60;
  return String(h).padStart(2,'0')+":"+String(m).padStart(2,'0')+":"+String(s).padStart(2,'0');
}

function submitAnswers(){
  clearInterval(timerInterval);

  let win=window.open("");
  win.document.write("<h2>Exam Submission Summary</h2>");
  win.document.write("<table border='1' cellpadding='8'>");
  win.document.write("<tr><th>Question</th><th>Answer</th></tr>");

  for(let i=1;i<=totalQ;i++){
    let ans="Not Answered";
    if(answers[i]){
      if(answers[i].type==="mcq") ans=answers[i].val.join(", ");
      else ans=answers[i].val;
    }
    win.document.write("<tr><td>"+i+"</td><td>"+ans+"</td></tr>");
  }

  win.document.write("</table>");
  win.document.close();
}
</script>

</body>
</html>
